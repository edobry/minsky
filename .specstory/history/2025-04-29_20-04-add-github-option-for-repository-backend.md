<!-- Generated by SpecStory -->

# Add GitHub Option for Repository Backend (2025-04-29 16:04:12)

_**User**_

create a task to add a concept of a "repository backend". the default option (and the one that's currently implicitly in use) is a "local git" backend. i want to also add a "github" option. when using the latter, `session create` should clone from the upstream repo on github rather than the local git repo.

---

_**Assistant**_

I'll help you create a task for adding repository backend support. Let me fetch the task creation rules first.

---

### Rule: creating-tasks

**Use this when creating a new task**

```markdown
# Task Creation Process

## ‚ö†Ô∏è IMPORTANT: Task Creation vs. Task Implementation
In Minsky, "creating a task" means authoring a task specification document and adding it to the tracking system - **not** implementing the code for that task.

- When the user requests to "create a task", always produce a task specification document
- Only proceed to implementation if explicitly instructed with phrases like "implement the task" or "write the code for"
- If there is any ambiguity, confirm with the user whether they want task specification or implementation

## ‚ö†Ô∏è IMPORTANT: Always Check for Existing Tasks First
- Before creating a new task, always check `process/tasks.md` and the `process/tasks/` directory for existing tasks that match the user's request
- If a matching task already exists:
  - Inform the user that the task already exists
  - Provide the task ID and title
  - Review the specification to verify it matches the user's requirements
  - Only create a new task if the existing one doesn't adequately cover the requested functionality
  - Never attempt to implement a task when only asked to create one

## Overview
All tasks and work items must be tracked using the canonical process described here. Ad-hoc or freeform task files (e.g., TODO.something.md) are NOT permitted. All tasks must be:
- Listed in `/process/tasks.md` as a checklist item
- Linked to a detailed task spec in `/process/tasks/{id}-{name}.md`

## Step-by-Step Task Creation Instructions

### 1. Check for Existing Tasks
- Before starting any new work, check `/process/tasks.md` for an existing task that matches your intended work.
- If a relevant task exists, follow its linked specification.

### 2. Add a New Task
- If no relevant task exists, add a new checklist item to `/process/tasks.md` using the following format:
  ```markdown
  - [ ] Task Title [#NNN](mdc:tasks/NNN-task-title.md)
  ```
  - Use the next available task number (NNN).
  - The title should be concise but descriptive.

### 3. Create the Task Specification Document
- Create a new file in `/process/tasks/` named `{NNN}-task-title.md`.
- The task spec should include:
  - **Objective**: What is the goal of the task?
  - **Context**: Background information and why this task is needed
  - **Requirements**: Specific, detailed requirements
  - **Implementation Steps**: A checklist of all required steps and substeps
  - **Verification**: What must be true for the task to be considered complete?
- Use checkboxes for all actionable items and sub-items.
- Include any relevant context, links, or references.

## Complete Example of a Task Specification

Here's a complete example of a properly formatted task specification document:

```markdown
# Task #007: Add `minsky task create` Command

## Context

The Minsky CLI currently lacks a streamlined way to create new tasks from specification documents. Users need to manually update the tasks.md file and ensure proper linking. An automated command would improve workflow efficiency and reduce errors.

## Requirements

1. **CLI Behavior**
   - Command signature:
     ```
     minsky tasks create <spec-path>
     ```
   - The command should:
     - Parse the provided task specification document
     - Extract the title and description
     - Assign the next available ID
     - Add a checklist item to process/tasks.md
     - Return the created task details

2. **Integration with Domain Module**
   - Use the TaskService domain module to record the task
   - Add a createTask method to the TaskService class
   - Implement createTask in the MarkdownTaskBackend

3. **Error Handling**
   - Validate that the spec file exists
   - Ensure the spec file has a valid title and description
   - Handle errors gracefully with informative messages

4. **CLI Options**
   - Support the following options:
     - `--session <session>`: Session name to use for repo resolution
     - `--repo <repoPath>`: Path to a git repository (overrides session)
     - `--backend <backend>`: Specify task backend (markdown, github)
     - `--json`: Output task as JSON

## Implementation Steps

1. [ ] Update TaskBackend interface to include createTask method
2. [ ] Implement createTask in MarkdownTaskBackend:
   - [ ] Parse the spec file to extract title and description
   - [ ] Find the next available task ID
   - [ ] Create a task entry in tasks.md
   - [ ] Return the created Task object
3. [ ] Add createTask method to TaskService
4. [ ] Create a new file in src/commands/tasks/create.ts:
   - [ ] Define command using Commander.js
   - [ ] Add appropriate options and arguments
   - [ ] Implement action handler to call domain method
   - [ ] Add proper error handling
5. [ ] Register command in src/commands/tasks/index.ts
6. [ ] Add tests for the new functionality
7. [ ] Update documentation

## Verification

- [ ] Running `minsky tasks create path/to/spec.md` successfully creates a task
- [ ] The task is added to process/tasks.md with correct formatting
- [ ] The command returns the created task details
- [ ] All options work as expected
- [ ] Error handling works correctly for invalid inputs
- [ ] Tests pass
```

## Task Type Recognition

Always distinguish between:

1. **Task Specification Requests**:
   - "Create a task for..."
   - "Add a task to..."
   - "Make a task that describes..."

2. **Task Implementation Requests**:
   - "Implement the task for..."
   - "Write the code that..."
   - "Let's code the feature for..."

When in doubt, default to creating a task specification document rather than implementing code.```

---

I'll create a task specification for adding repository backend support. First, let me check if there's an existing task that matches this request.

---

<details>
            <summary>Listed directory process/tasks ‚Ä¢ **13** results</summary>
        
| Name |
|-------|
| üìÑ `002-per-repo-session-storage.md` |
| üìÅ `013` |
| üìÑ `001-update-session-start-task-id.md` |
| üìÅ `011` |
| üìÅ `012` |
| üìÑ `004-add-task-option-to-session-get.md` |
| üìÑ `009-add-git-commit-command.md` |
| üìÑ `010-enhance-git-pr-command.md` |
| üìÑ `008-update-tasks-list-hide-done.md` |
| üìÑ `007-add-tasks-create-command.md` |
| üìÑ `005-add-git-push-command.md` |
| üìÑ `006-add-quiet-option-to-session-start.md` |
| üìÑ `003-add-init-command.md` |

</details>

---

Tool call timed out after 10s (read file)

---

I'll create a new task specification with ID #014 since I can see from the directory listing that we have tasks up to #013. I'll create the task specification document for adding repository backend support.

---

```diff
- 
+ # Task #014: Add Repository Backend Support
+ 
+ ## Context
+ 
+ Currently, Minsky implicitly uses a local git repository as its backend for session management. To support more flexible workflows and remote repository integration, we need to introduce an explicit concept of repository backends. This will allow us to support different repository sources, starting with GitHub integration.
+ 
+ ## Requirements
+ 
+ 1. **Repository Backend Interface**
+    - Create an abstract interface for repository operations
+    - Support multiple backend implementations:
+      - Local Git (default, current implementation)
+      - GitHub (new)
+    - Operations to support:
+      - Clone repository
+      - Get repository status
+      - Get repository path
+      - Validate repository
+ 
+ 2. **Session Integration**
+    - Add repository backend configuration to session configuration
+    - Default to "local" backend for backward compatibility
+    - Support "github" backend option
+    - Update session creation to use the configured backend
+ 
+ 3. **GitHub Backend Implementation**
+    - Implement GitHub repository backend
+    - Support cloning from GitHub during session creation
+    - Handle GitHub-specific repository operations
+    - Support authentication and access token management
+ 
+ 4. **CLI Updates**
+    - Add repository backend option to relevant commands:
+      ```
+      minsky session create --backend github
+      ```
+    - Support GitHub-specific options:
+      - `--github-token`: GitHub access token
+      - `--github-owner`: Repository owner
+      - `--github-repo`: Repository name
+ 
+ 5. **Configuration**
+    - Add GitHub configuration options to Minsky config:
+      - Default GitHub token
+      - Default repository owner
+      - Other GitHub-specific settings
+ 
+ 6. **Error Handling**
+    - Handle GitHub API errors gracefully
+    - Provide clear error messages for:
+      - Authentication failures
+      - Repository not found
+      - Network issues
+      - Permission issues
+ 
+ ## Implementation Steps
+ 
+ 1. [ ] Create Repository Backend Interface
+    - [ ] Define `RepositoryBackend` interface in domain layer
+    - [ ] Extract current git operations into `LocalGitBackend` class
+    - [ ] Update existing code to use the new interface
+ 
+ 2. [ ] Implement GitHub Backend
+    - [ ] Create `GitHubBackend` class implementing `RepositoryBackend`
+    - [ ] Add GitHub API integration
+    - [ ] Implement repository operations for GitHub
+    - [ ] Add GitHub authentication handling
+ 
+ 3. [ ] Update Session Management
+    - [ ] Add backend configuration to session settings
+    - [ ] Modify session creation to use configured backend
+    - [ ] Update session commands to support backend selection
+ 
+ 4. [ ] Add Configuration Support
+    - [ ] Add GitHub configuration options
+    - [ ] Implement configuration validation
+    - [ ] Add configuration documentation
+ 
+ 5. [ ] Update CLI Commands
+    - [ ] Add backend option to session commands
+    - [ ] Add GitHub-specific options
+    - [ ] Update command documentation
+ 
+ 6. [ ] Add Tests
+    - [ ] Unit tests for backend interface
+    - [ ] Tests for LocalGitBackend
+    - [ ] Tests for GitHubBackend
+    - [ ] Integration tests for session creation
+    - [ ] Test error handling scenarios
+ 
+ 7. [ ] Update Documentation
+    - [ ] Document backend configuration
+    - [ ] Add GitHub setup instructions
+    - [ ] Update command reference
+    - [ ] Add examples for different backends
+ 
+ ## Verification
+ 
+ - [ ] Local git backend works exactly as before (backward compatibility)
+ - [ ] GitHub backend successfully clones repositories
+ - [ ] Session creation works with both backends
+ - [ ] Configuration options are properly handled
+ - [ ] Error scenarios are properly handled with clear messages
+ - [ ] All tests pass
+ - [ ] Documentation is complete and accurate
+ 
+ ## Dependencies
+ 
+ - GitHub API access
+ - GitHub authentication mechanism
+ - Existing session management code
+ 
+ ## Notes
+ 
+ - Consider future backend implementations (e.g., GitLab, Bitbucket)
+ - Ensure backward compatibility for existing sessions
+ - Consider migration path for existing sessions to explicit backend configuration 
+ 
```

---

Now I'll update the tasks.md file to include this new task.

---

```diff
  - [ ] Fix `git pr` command and add proper tests [#011](tasks/011-git-pr-fix.md)
  - [ ] Add `session update` command to sync session with main branch [#012](tasks/012/spec.md)
+ - [ ] Add Repository Backend Support [#014](mdc:tasks/014-add-repository-backend-support.md)
  
```

---

I've created a new task specification (#014) for adding repository backend support. The task specification includes:

1. A clear context explaining why we need repository backends
2. Detailed requirements covering the backend interface, session integration, GitHub implementation, CLI updates, configuration, and error handling
3. Step-by-step implementation plan
4. Verification checklist
5. Dependencies and notes for future consideration

The task has been added to both:
- `process/tasks/014-add-repository-backend-support.md` (full specification)
- `process/tasks.md` (task list entry)

The specification is designed to maintain backward compatibility while adding the new GitHub backend option. It includes all the necessary components for both the domain layer changes (backend interface and implementations) and the user-facing changes (CLI options and configuration).

Would you like me to clarify or modify any part of the task specification?

---

