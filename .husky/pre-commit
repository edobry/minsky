#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Checking for variable naming issues..."

# Run the variable naming checker
if ! bun run scripts/check-variable-naming.ts; then
  echo "‚ùå Variable naming issues found! Please fix them before committing."
  echo "üí° You can run 'bun run scripts/fix-variable-naming.ts' to auto-fix many issues."
  exit 1
fi

echo "‚úÖ No variable naming issues found."

# Run linting
echo "üîç Running ESLint..."
if ! npm run lint; then
  echo "‚ùå Linting failed! Please fix the issues before committing."
  exit 1
fi

# Migration Safety Check
echo "üîí Checking migration safety..."
if git diff --cached --name-only --diff-filter=D | grep -E '\.(ts|js)$' > /dev/null; then
  echo "‚ö†Ô∏è  File deletions detected!"
  echo "Please ensure migration safety protocol was followed:"
  echo "1. Functionality inventory completed"
  echo "2. All usage locations migrated" 
  echo "3. Zero usage verification passed"
  echo "4. Rollback branch created"
  echo ""
  echo "See: .cursor/rules/migration-safety-protocol.mdc"
  echo ""
  read -p "Confirm migration safety protocol was followed (y/N): " confirm
  if [ "$confirm" != "y" ] && [ "$confirm" != "Y" ]; then
    echo "‚ùå Commit blocked - migration safety protocol required"
    exit 1
  fi
fi

echo "‚úÖ All checks passed!"
