echo "Running tests before push..."

# Run tests quietly - capture output and only show failures
# Note: AGENT=1 was supposed to enable quiet mode (commit 6421d2c50) but doesn't actually work with Bun
TEST_OUTPUT=$(bun test --preload ./tests/setup.ts --timeout=15000 src tests/adapters tests/domain 2>&1)
TEST_EXIT=$?

# Only show output if tests failed
if [ $TEST_EXIT -ne 0 ]; then
  echo "$TEST_OUTPUT" | grep -E "^‚úó" || true
  echo "$TEST_OUTPUT" | tail -n 5
  echo ""
  echo "‚ùå Tests must pass before pushing"
  echo "üí° Run 'bun test' locally to see detailed failure information"
  exit 1
fi

# For success, just show minimal summary
echo "$TEST_OUTPUT" | tail -n 1
echo "‚úÖ All tests passed! Proceeding with push."
