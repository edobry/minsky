## Work Log

- Refactored all domain and command tests to remove Bun's mock API (`mock.fn`, `mock.module`, `mock.restoreAll`).
- Replaced all mocks with manual mock functions compatible with Bun.
- Updated all test assertions to use manual checks on mock `.calls` arrays instead of Jest/Bun matchers.
- Verified that domain tests now pass and command test files are free of Bun mock API usage.
- Ran the full test suite; most tests now pass, but some command/CLI tests (notably `git commit`) still fail.
- **Root cause:** The `createGitCommitCommand` and related CLI implementations do not support dependency injection, so tests cannot inject manual mocks. The implementation uses real dependencies, making the mocks ineffective.
- **Next steps:** Refactor CLI command implementations to accept dependencies via parameters (dependency injection), update tests to pass manual mocks, and verify all tests pass.

## Remaining Work

- Refactor `createGitCommitCommand` and related CLI commands to support dependency injection for all dependencies (e.g., `GitService`, `SessionDB`, `resolveRepoPath`).
- Update all affected tests to inject manual mocks.
- Re-run the test suite to confirm all tests pass with the new structure.
- Review for any other CLI or command modules that require similar refactoring for testability. 
