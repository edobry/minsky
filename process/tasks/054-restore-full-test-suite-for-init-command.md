# Restore Full Test Suite for `init` Command

## Context

The `init` command tests in `src/commands/init/index.test.ts` are currently a simplified version. This was a pragmatic short-term solution due to compatibility issues with `bun:test` mocking (specifically `mock.fn()` and detailed call assertions like `toHaveBeenCalledWith`) in Bun v1.2.13. The simplified tests only verify command creation and the presence of command-line options. A more comprehensive suite is needed to ensure the `init` command's logic, including its interactions with user prompts (`@clack/prompts`) and the `initializeProject` domain function, behaves correctly under various scenarios (flags, interactive inputs, MCP configurations). The previous full test suite can be found around git commit `7050f86cbfedb4841b85b25acbfe08e2f7fb7c83`.

## 1. Goal

Restore the comprehensive test suite for the `src/commands/init/index.ts` command, ensuring full coverage of its logic and interactions.

## 2. Requirements / Desired State

- The test suite in `src/commands/init/index.test.ts` should provide full coverage for the `init` command's functionality.
- This includes testing:
  - Initialization with default MCP (Model Context Protocol) settings.
  - MCP disabled via `--mcp false`.
  - Custom MCP transport and network settings (flags and interactive).
  - Skipping network prompts for `stdio` transport.
  - Skipping detailed MCP prompts if MCP is disabled.
  - Correct functionality of `--mcp-only` and `--overwrite` flags, and their combination.
  - Graceful handling of user cancellation during prompts.
- All tests must pass reliably.
- Any linting errors related to mocking must be resolved.

## 3. Challenges to Address

- **Bun Test Mocking**: Implement robust mocking for module functions and `@clack/prompts` that works with the target Bun version and allows detailed call assertions (e.g., `toHaveBeenCalledWith(expect.objectContaining(...))`).
- **Type Compatibility**: Ensure mock implementations are type-compatible and pass linting.
- **Inspiration**: Leverage successful mocking patterns from other tests in the project.

## 4. Acceptance Criteria

- All detailed test cases are implemented and pass.
- Dependencies are correctly mocked.
- `initializeProject` calls and prompt behavior are accurately verified.
- No linting errors in `src/commands/init/index.test.ts`.
- The overall project test suite (`bun test`) passes.

## 5. Work Log & Verification

_(This section will be filled upon task completion)_

---

_Generated by Minsky AI_
