# Task #107: Refactor GitService to Functional Patterns (Subtask of #102)

## Context

This task is a subtask of #102 (Refactor Domain Objects to Follow Functional Patterns). It focuses on refactoring the `GitService` module to align with functional programming principles. The goal is to make Git operations more predictable, testable, and easier to reason about by separating pure logic from side effects (like executing actual git commands).

## Requirements

1.  **Pure Functions for `GitService` Operations**:

    - Convert all core methods in `GitService` (e.g., `clone`, `branch`, `commit`, `push`, `pullLatest`, `mergeBranch`, `stashChanges`, `popStash`, `execInRepository`, `getRemoteUrl`, `getCurrentBranch`, etc.) into pure functions where feasible.
    - These functions should not directly execute git commands or interact with the file system where avoidable.
    - State (like repository path, current branch, remote URLs if not discoverable through pure means) and necessary configurations should be passed explicitly.
    - Functions that would conceptually modify repository state should describe the intended operation or return parameters for an effect-handling function.

2.  **Explicit Command Generation/Description**:

    - Instead of directly executing git commands, pure functions should primarily generate the git command strings or a descriptive structure of the git operation to be performed.
    - For example, a `commitFn` might take commit details and return an object like `{ command: "git", args: ["commit", "-m", "message"] }`.

3.  **Isolation of Side Effects (Git Command Execution)**:

    - The actual execution of git commands must be isolated from the pure functions.
    - This will likely involve a dedicated executor module/service that takes the command descriptions generated by the pure functions and executes them, handling any output or errors.

4.  **Functional Composition**:

    - Utilize functional composition for complex git workflows, building them from simpler, pure command-generating functions.

5.  **Update Tests**:

    - Rewrite unit tests to focus on the pure functions, verifying correct command generation or operation description based on inputs.
    - Integration tests will need to mock the git command executor to verify that the correct commands are sent for execution and to simulate different outcomes (success, failure, specific outputs).

6.  **Maintain Interface Contracts**:
    - The public interface of `GitService` (or its replacement) should aim to fulfill existing contracts used by other parts of the application, though the underlying implementation will change significantly. Document any unavoidable breaking changes.

## Implementation Steps

1.  [ ] Analyze current `GitService` methods, identify git commands executed, and inputs/outputs.
2.  [ ] Define data structures for representing git command descriptions/operations.
3.  [ ] Implement pure function versions for each `GitService` operation to generate these descriptions:
    - Example: `generateCloneCommand(repoUrl, localPath, options)`
    - Example: `generateCommitCommand(message, options)`
    - ...
4.  [ ] Create a `GitCommandExecutor` service/module responsible for:
    - [ ] Taking a command description and executing it (e.g., using `child_process`).
    - [ ] Handling stdout, stderr, and exit codes.
    - [ ] Returning results or throwing structured errors.
5.  [ ] Refactor existing code using `GitService` to use the new pure functions and the `GitCommandExecutor`.
6.  [ ] Update unit tests for `GitService` logic (now command generation).
7.  [ ] Update/create integration tests for the `GitCommandExecutor` and for workflows involving multiple git operations.
8.  [ ] Document the new architecture for `GitService` and its usage.

## Verification

- [ ] Core `GitService` logic is implemented as pure functions generating command descriptions.
- [ ] Git command execution is isolated in a dedicated executor.
- [ ] All existing tests pass or are updated; new tests provide adequate coverage.
- [ ] Git-dependent features of the application remain functional.
- [ ] Conforms to linting and style guidelines.

Parent Task: #102
